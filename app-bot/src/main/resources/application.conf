# application.conf — параметры Ktor

# если хотите профили, можно раскомментировать:
# include file("application-${?APP_ENV}.conf")

ktor {
  deployment {
    host = "0.0.0.0"
    port = 8080               # фиксируем дефолт, порт наружу публикует Caddy
    # не задаём повторно через ${?PORT}, чтобы не словить null при отсутствии переменной
  }

  application {
    modules = [ com.example.bot.ApplicationKt.module ]
  }

  routing {
    webhook = "/webhook"
    health  = "/health"
    metrics = "/metrics"
    api     = "/api"
  }

  netty {
    requestReadTimeoutSeconds    = 15
    responseWriteTimeoutSeconds  = 15
    connectionIdleTimeoutSeconds = 45
  }
}

observability {
  prometheus           = ${?METRICS_PROMETHEUS_ENABLED}
  health-db-timeout-ms = ${?HEALTH_DB_TIMEOUT_MS}
}

tracing {
  enabled       = ${?TRACING_ENABLED}
  otlp-endpoint = ${?OTEL_EXPORTER_OTLP_ENDPOINT}
  service-name  = ${?OTEL_SERVICE_NAME}
}

log {
  json  = ${?LOG_JSON}
  level = ${?LOG_LEVEL}
}